<html>
    <head>
        <title>My first three.js app</title>
        <style>
            body { margin: 0; }
            canvas { display: block; }
        </style>
    </head>
    <body>
        <script src="three.js-master/build/three.js"></script>
        <script src="three.js-master/examples/js/controls/OrbitControls.js"></script>
        <script>
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
 
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );
            
            var controls = new THREE.OrbitControls( camera, renderer.domElement );
 
            camera.position.z = 10;
 
            var angle = 22.5 * Math.PI/180;
            var axiom = 'X';
            var sentence = axiom;
            var len = 1;
 
            var rules = [];
            /*
            rules[0] = {
                a: 'F',
                b: 'F+F-F-F+F'
            };*/
            
            rules[0] = {
                a: 'X',
                b: 'F+[[F]-X]-F[-FX]+X'
            };
            
            rules[1] = {
                a: 'F',
                b: 'FF' 
            };
 
            function generate() {
                //len *= 0.5;
                let nextSentence = '';
                for (let i = 0; i < sentence.length; i++) {
                    let current = sentence.charAt(i);
                    let found = false;
                    for (let j = 0; j < rules.length; j++) {
                        if (current == rules[j].a) {
                            found = true;
                            nextSentence += rules[j].b;
                            break;
                        }
                    }
                    if (!found) {
                        nextSentence += current;
                    }
                }
                sentence = nextSentence;
                
                console.log(sentence);
                turtle();
            }
 
            
            
 
            
            var mat = [];
 
            mat = new THREE.Matrix4();
            mat.set( 1,0,0,0,
                    0,1,0,0,
                    0,0,1,0,
                    0,0,0,1);

            let geometry = new THREE.CylinderGeometry(1, 1, len, 32 );
            var material = new THREE.MeshBasicMaterial( {color: 0x00ff00} );
 
            function turtle() {
                let turtle = {
                    len: len,
                    pos: new THREE.Vector3(0,0,0),
                    rot: new THREE.Vector3(0,0,0)
                };
                
                let turtleHistory = [];
                turtleHistory.push(turtle);
                
                for (let i = 0; i < sentence.length; i++) {    
                    let current = sentence.charAt(i);
                    
                    geometry = new THREE.CylinderGeometry(1, 1, len, 32 );
                    
                    if (current == 'F') {
                        turtle.len *= 0.5;
                        turtle.pos.x += len*Math.cos(turtle.rot.z);
                        turtle.pos.y += len*Math.sin(turtle.rot.y);
                        turtle.pos.z += len*Math.cos(turtle.rot.x);
                        geometry.translate(turtle.pos.x,turtle.pos.y,turtle.pos.z);
                        geometry.rotateX(turtle.rot.z);
                        
                        scene.add(new THREE.Mesh( geometry, material ));
                    } else if (current == 'X') {
                        turtle.len *= 0.5;
                        turtle.pos.x += len*Math.cos(turtle.rot.z);
                        turtle.pos.y += len*Math.sin(turtle.rot.y);
                        turtle.pos.z += len*Math.cos(turtle.rot.x);
                    } else if (current == '+') {
                        turtle.rot.x += angle; //ska antagligen egentligen vara y
                    } else if (current == '-') {
                        turtle.rot.x -= angle; //ska antagligen egentligen vara y
                    } else if (current == '&') {
                        turtle.rot.x += angle;
                    } else if (current == '^') {
                        turtle.rot.x -= angle;
                    } else if (current == '%') {
                        turtle.rot.z += angle;
                    } else if (current == '/') {
                        turtle.rot.z -= angle;
                    } else if (current == '|') {
                        turtle.rot.y += Math.PI;
                    } else if (current == '[') {
                        turtleHistory.push(turtle);
                        turtle = turtleHistory[turtleHistory.length -1];
                    } else if (current == ']') {
                        turtleHistory.pop();
                        turtle = turtleHistory[turtleHistory.length -1];
                    }
                }
            }
 
            generate();
            generate();
            generate();
            generate();
 
            controls.update();
 
            var animate = function () {
                requestAnimationFrame( animate );
 
                controls.update();
                renderer.render( scene, camera );               
            };
 
            animate();
        </script>
    </body>
</html>

